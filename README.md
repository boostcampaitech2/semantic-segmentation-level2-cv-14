# ì¬í™œìš© ì“°ë ˆê¸° Semantic Segmentation

<img src="https://user-images.githubusercontent.com/44287798/140461430-78e5cd84-2162-4f98-9d27-bbc3a8580f90.png" width="400">  <img src="https://user-images.githubusercontent.com/44287798/140461384-a0a91b44-da3a-4b81-95cb-ec508b978aa7.png" width="400"> 


## í”„ë¡œì íŠ¸ ê°œìš”

ìš°ë¦¬ëŠ” ë§ì€ ë¬¼ê±´ì´ ëŒ€ëŸ‰ìœ¼ë¡œ ìƒì‚°ë˜ê³ , ì†Œë¹„ë˜ëŠ” ì‹œëŒ€ë¥¼ ì‚´ê³  ìˆê³  ì´ëŸ¬í•œ ë¬¸í™”ëŠ” 'ì“°ë ˆê¸° ëŒ€ë€', 'ë§¤ë¦½ì§€ ë¶€ì¡±'ê³¼ ê°™ì€ ì—¬ëŸ¬ ì‚¬íšŒ ë¬¸ì œë¥¼ ë‚³ê³  ìˆë‹¤.
 ë¶„ë¦¬ìˆ˜ê±°ëŠ” ì´ëŸ¬í•œ í™˜ê²½ ë¶€ë‹´ì„ ì¤„ì¼ ìˆ˜ ìˆëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ë¡œ, ì˜ ë¶„ë¦¬ë°°ì¶œ ëœ ì“°ë ˆê¸°ëŠ” ìì›ìœ¼ë¡œì„œ ê°€ì¹˜ë¥¼ ì¸ì •ë°›ì•„ ì¬í™œìš©ë˜ì§€ë§Œ, ì˜ëª» ë¶„ë¦¬ë°°ì¶œ ë˜ë©´ ê·¸ëŒ€ë¡œ íê¸°ë¬¼ë¡œ ë¶„ë¥˜ë˜ì–´ ë§¤ë¦½ ë˜ëŠ” ì†Œê°ë˜ê¸° ë•Œë¬¸ì´ë‹¤.
 
ìš°ë¦¬ëŠ” ì‚¬ì§„ì—ì„œ ì“°ë ˆê¸°ë¥¼ íƒì§€í•˜ëŠ” ëª¨ë¸ì„ ë§Œë“¤ì–´ ì´ëŸ¬í•œ ë¬¸ì œì ì„ í•´ê²°í•´ë³´ê³ ì í•œë‹¤. ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ë°ì´í„°ì…‹ìœ¼ë¡œëŠ” ì¼ë°˜ ì“°ë ˆê¸°, í”Œë¼ìŠ¤í‹±, ì¢…ì´, ìœ ë¦¬ ë“± 10 ì¢…ë¥˜ì˜ ì“°ë ˆê¸°ê°€ ì°íŒ ì‚¬ì§„ ë°ì´í„°ì…‹ì„ ì‚¬ìš©í•œë‹¤. ìš°ìˆ˜í•œ ì„±ëŠ¥ì˜ ëª¨ë¸ì€ ì“°ë ˆê¸°ì¥ì— ì„¤ì¹˜ë˜ì–´ ì •í™•í•œ ë¶„ë¦¬ìˆ˜ê±°ë¥¼ ë•ê±°ë‚˜, ì–´ë¦°ì•„ì´ë“¤ì˜ ë¶„ë¦¬ìˆ˜ê±° êµìœ¡ ë“±ì— ì‚¬ìš©ë  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

## íŒ€ì› ì†Œê°œ
íŒ€ëª…: Machine==ìš°ë¦¬ì¡° 

||ì´ë¦„|ì—­í• |github|
|--|------|---|---|
|ğŸ˜™|ê¹€ë²”ìˆ˜|PSPNet, HRNet_fcn, SwinT ì‹¤í—˜|https://github.com/HYU-kbs|
|ğŸ¤—|ê¹€ì¤€íƒœ|FCN, FPN, DeepLab V3+ ì‹¤í—˜|https://github.com/sronger|
|ğŸ˜|ê¹€ì§€ì„±|ê³µìš© ì‹¤í—˜ í”Œë«í¼ ê°œë°œ, UNet++ ì‹¤í—˜, Pseudo Labeling ë„êµ¬ ê°œë°œ, Object Mix Augmentation ë„êµ¬ ê°œë°œ|https://github.com/intelli8786|
|ğŸ˜†|ë°±ì¢…ì›|Unet++, DeepLab V3+ ì‹¤í—˜|https://github.com/Baek-jongwon|
|ğŸ˜Š|ì •ì†Œí¬|PSPNet, DeepLab V3+, SEResNext101+CBAM ì‹¤í—˜|https://github.com/SoheeJeong|
|ğŸ˜„|í™ì§€ì—°|Unet, Hrnet OCR ì‹¤í—˜|https://github.com/hongjourney|


## ëª¨ë¸ ì„±ëŠ¥ ë° config file

í•™ìŠµëœ ëª¨ë¸ì— ëŒ€í•œ ì„¤ëª…ê³¼ ì„±ëŠ¥, ê° ëª¨ë¸ì— ëŒ€í•œ config fileì˜ ìœ„ì¹˜ë¥¼ í‘œë¡œ ë‚˜íƒ€ë‚´ì—ˆë‹¤.
config fileì€ json í˜•ì‹ìœ¼ë¡œ, hyperparameter, model architecture, optimizer, scheduler, train/test dataset ë“± ëª¨ë¸ì— ëŒ€í•œ ì „ë°˜ì ì¸ í•™ìŠµ ì •ë³´ë¥¼ í¬í•¨í•œë‹¤. 

|ëª¨ë¸|config|
|------|---|
|DeepLabV3P_Effib4_NoAug|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/DeepLabV3P_Effib4_NoAug.json)|
|Hrnet_Ocr_NoAug|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/Hrnet_Ocr_NoAug.json)|
|Hrnet_Ocr_aug|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/Hrnet_Ocr_aug.json)|
|Hrnet_Ocr_aug_gridmask|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/Hrnet_Ocr_aug_gridmask.json)|
|Hrnet_Ocr_aug_pseudo|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/Hrnet_Ocr_aug_pseudo.json)|
|PAN_ResNext101|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/PAN_ResNext101.json)|
|PAN_ResNext101_pseudo|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/PAN_ResNext101_pseudo.json)|
|UNetPP_Effib3_DiceCE_AdamW|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/UNetPP_Effib3_DiceCE_AdamW.json)|
|UNetPP_Effib3_DiceCE_AdamW_pseudo|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/UNetPP_Effib3_DiceCE_AdamW_pseudo.json)|
|UNetPP_Effib4|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/UNetPP_Effib4.json)|
|UNetPP_Effib4_AdamW|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/UNetPP_Effib4_AdamW.json)|
|UNetPP_Effib4_DiceCE|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/UNetPP_Effib4_DiceCE.json)|
|UNetPP_Effib4_DiceCE_AdamW|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/UNetPP_Effib4_DiceCE_AdamW.json)|
|UNetPP_Effib4_DiceCE_AdamW_ObMix|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/UNetPP_Effib4_DiceCE_AdamW_ObMix.json)|
|UNetPP_Effib4_DiceCE_AdamW_ObMix_pseudo|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/UNetPP_Effib4_DiceCE_AdamW_ObMix_pseudo.json)|
|UNetPP_Effib4_DiceCE_AdamW_pseudo|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/UNetPP_Effib4_DiceCE_AdamW_pseudo.json)|
|UNetPP_Effib4_aug|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/UNetPP_Effib4_aug.json)|
|UNetPP_Effib4_aug_AdamW|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/UNetPP_Effib4_aug_AdamW.json)|
|UNetPP_Effib4_aug_DiceCE|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/UNetPP_Effib4_aug_DiceCE.json)|
|UNetPP_Effib4_aug_DiceCE_AdamW|[config](https://github.com/boostcampaitech2/semantic-segmentation-level2-cv-14/blob/master/Configs/UNetPP_Effib4_aug_DiceCE_AdamW.json)|

## ì‹¤í–‰íŒŒì¼ ì„¤ëª…

### Train
<details>
 <summary> ì´ ì½”ë“œëŠ” ë‹¤ìŒ ê¸°ëŠ¥ì„ í¬í•¨í•©ë‹ˆë‹¤. </summary>
 
 - pytorch ê¸°ë°˜ì˜ Semantic Segmentation Model ì„ í•™ìŠµí•©ë‹ˆë‹¤.
 - config.json íŒŒì¼ì„ í†µí•´ í•™ìŠµ ì¸ìë¥¼ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

 - ì‚¬ìš©ë²•
    Train.py --config Configs/UNetPP_Efficientb4_aug_train.json

 - ì¶œë ¥
    'path_project_root' ê°’ìœ¼ë¡œ ì§€ì •í•œ ê²½ë¡œì— ë‹¤ìŒê³¼ ê°™ì€ íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤.
        best_score.pt : ëª¨ë¸ì´ ê°€ì¥ ë†’ì€ validation scoreë¥¼ ê¸°ë¡í–ˆë˜ ì‹œì ì˜ weight íŒŒì¼ì…ë‹ˆë‹¤.
        logs/
            best_score.log : ëª¨ë¸ì´ ê°€ì¥ ë†’ì€ validation scoreë¥¼ ê°±ì‹ í–ˆë˜ ì‹œì ì˜ epochì™€ ì ìˆ˜ë¥¼ ê¸°ë¡í•œ íŒŒì¼ì…ë‹ˆë‹¤.
            config.json : ëª¨ë¸ í•™ìŠµì— ì‚¬ìš©ëë˜ config.json íŒŒì¼ ì‚¬ë³¸ì…ë‹ˆë‹¤.
            train.log : í•™ìŠµ ì¶œë ¥ ê¸°ë¡ì…ë‹ˆë‹¤.
            valid.log : ê²€ì¦ ì¶œë ¥ ê¸°ë¡ì…ë‹ˆë‹¤.
</details>
<details>
 <summary> ì¢…ì† íŒŒì¼ ëª…ì„¸ </summary>
 
    - Modules/Data.py : Custom Dataset í´ë˜ìŠ¤ê°€ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤. (í˜„ì¬ëŠ” ë¶€ìŠ¤íŠ¸ìº í”„ ì»´í”¼í‹°ì…˜ìš© COCO formatë§Œ ì§€ì›í•©ë‹ˆë‹¤.)
    - Modules/Models.py : Semantic Segmentation ëª¨ë¸ë“¤ì´ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
    - Modules/Losses.py : í•™ìŠµì— ì‚¬ìš©ë  Lossë“¤ì´ ì •ì˜ë˜ì–´ìˆìŠµë‹ˆë‹¤.
    - Modules/Optimizer.py : í•™ìŠµì— ì‚¬ìš©ë  Optimizerë“¤ì´ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
    - Modules/Transform_Preprocess.py : ì´ë¯¸ì§€ ì „ì²˜ë¦¬ë¥¼ ìœ„í•œ Transformë“¤ì´ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
    - Utils/Tools.py : ê°ì¢… í¸ì˜ê¸°ëŠ¥ë“¤ì´ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
    - Utils/utils.py : Semantic Segmentation score ê³„ì‚°ì„ ìœ„í•œ ë„êµ¬ë“¤ì´ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
</details>
<details>
 <summary> ê¸°ë³¸ config_train.json ìš”ì†Œ ëª…ì„¸ </summary>
 
    - path_dataset_root : ë°ì´í„°ì…‹ì´ ì €ì¥ëœ rootë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - path_train_json : train ë°ì´í„° json íŒŒì¼ì„ ì •ì˜í•©ë‹ˆë‹¤.
    - path_valid_json : test ë°ì´í„° json íŒŒì¼ì„ ì •ì˜í•©ë‹ˆë‹¤.
    - path_project_root : í•™ìŠµë  ëª¨ë¸ì´ ì €ì¥ë  ë””ë ‰í† ë¦¬ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - random_fix : ë‚œìˆ˜ ê³ ì • ì—¬ë¶€ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - random_seed : ê³ ì •í•  seedë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - model : Semantic Segmentation ëª¨ë¸ì„ ì •ì˜í•©ë‹ˆë‹¤.
    - model_num_epochs : í•™ìŠµ epoch ìˆ˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - model_batch_size : ëª¨ë¸ì˜ ë°°ì¹˜ í¬ê¸°ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - loss : í•™ìŠµì— ì‚¬ìš©í•  lossë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - optimizer : í•™ìŠµì— ì‚¬ìš©í•  optimizerë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - optimizer_learning_rate : í•™ìŠµì— ì‚¬ìš©í•  learning rateë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - optimizer_weight_decay : í•™ìŠµì— ì‚¬ìš©í•  weight decayë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - data_num_workers : data loader ê°€ ì‚¬ìš©í•  í”„ë¡œì„¸ìŠ¤ ìˆ˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - data_loading_mode : ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ë¡œë“œí•˜ê±°ë‚˜, ì‹¤ì‹œê°„ìœ¼ë¡œ ë¡œë“œí•˜ëŠ” ëª¨ë“œë¥¼ ì •ì˜í•©ë‹ˆë‹¤. 'preload' ë˜ëŠ” 'realtime' ìœ¼ë¡œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - data_train_transform : í•™ìŠµì— ì‚¬ìš©ë  ì „ì²˜ë¦¬ transformì„ ì •ì˜í•©ë‹ˆë‹¤.
    - data_valid_transform : ê²€ì¦ì— ì‚¬ìš©ë  ì „ì²˜ë¦¬ transformì„ ì •ì˜í•©ë‹ˆë‹¤. ('Default'ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.)
</details>

### Test

<details>
 <summary> ì´ ì½”ë“œëŠ” ë‹¤ìŒ ê¸°ëŠ¥ì„ í¬í•¨í•©ë‹ˆë‹¤. </summary>
 
 - pytorch ê¸°ë°˜ì˜ Semantic Segmentation Model ì„ Inference í•´ì„œ submission.csv íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.
 - config.json íŒŒì¼ì„ í†µí•´ ì¶”ë¡  ì¸ìë¥¼ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

 - ì‚¬ìš©ë²•
    Inference_Test.py --config Configs/UNetPP_Efficientb4_aug_test.json

 - ì¶œë ¥
    'path_save' ê°’ìœ¼ë¡œ ì§€ì •í•œ ê²½ë¡œì— ë‹¤ìŒê³¼ ê°™ì€ íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤.
        submission.csv : ë¶€ìŠ¤íŠ¸ìº í”„ ì»´í”¼í‹°ì…˜ í˜•ì‹ì— ë§ì¶”ì–´ ìƒì„±ëœ Segmentation ê²°ê³¼ íŒŒì¼ì…ë‹ˆë‹¤.
</details>

<details>
 <summary> ì¢…ì† íŒŒì¼ ëª…ì„¸ </summary>
 
    - Modules/Data.py : Custom Dataset í´ë˜ìŠ¤ë“¤ì´ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤. (í˜„ì¬ëŠ” ë¶€ìŠ¤íŠ¸ìº í”„ ì»´í”¼í‹°ì…˜ìš© COCO formatë§Œ ì§€ì›í•©ë‹ˆë‹¤.)
    - Modules/Transform_Preprocess.py : ì´ë¯¸ì§€ ì „ì²˜ë¦¬ë¥¼ ìœ„í•œ Transformë“¤ì´ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
    - Modules/Models.py : Semantic Segmentation ëª¨ë¸ë“¤ì´ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
    - Modules/Transform_TTA.py : TTAë¥¼ ìœ„í•œ Transform ë“¤ì´ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
    - Utils/Tools.py : ê°ì¢… í¸ì˜ê¸°ëŠ¥ë“¤ì´ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
</details>
<details>
 <summary> ê¸°ë³¸ config_test.json ìš”ì†Œ ëª…ì„¸ </summary>
 
    - path_dataset_root : ë°ì´í„°ì…‹ì´ ì €ì¥ëœ rootë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - path_test_json : test ë°ì´í„° json íŒŒì¼ì„ ì •ì˜í•©ë‹ˆë‹¤.
    - path_checkpoint : í•™ìŠµëœ ëª¨ë¸ì˜ weightê°€ ì €ì¥ëœ ê²½ë¡œë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - random_fix : ë‚œìˆ˜ ê³ ì • ì—¬ë¶€ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - random_seed : ê³ ì •í•  seedë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - model : Semantic Segmentation ëª¨ë¸ì„ ì •ì˜í•©ë‹ˆë‹¤.
    - model_batch_size : ëª¨ë¸ì˜ ë°°ì¹˜ í¬ê¸°ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - data_num_workers : data loader ê°€ ì‚¬ìš©í•  í”„ë¡œì„¸ìŠ¤ ìˆ˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    - data_loading_mode : ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ë¡œë“œí•˜ê±°ë‚˜, ì‹¤ì‹œê°„ìœ¼ë¡œ ë¡œë“œí•˜ëŠ” ëª¨ë“œë¥¼ ì •ì˜í•©ë‹ˆë‹¤. 'preload' ë˜ëŠ” 'realtime' ìœ¼ë¡œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - data_test_transform : í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©ë  ì „ì²˜ë¦¬ transformì„ ì •ì˜í•©ë‹ˆë‹¤. ('Default'ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.)
    - data_tta_transform : TTAì— ì‚¬ìš©ë  transformì„ ì •ì˜í•©ë‹ˆë‹¤.
    - data_target_size : ì¶”ë¡  í›„ submissionì„ ìƒì„±í•  ë•Œ ë³€í™˜ë¨ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. (256ì„ ì¶”ì²œí•©ë‹ˆë‹¤.)
</details>

### HRNet OCR í•™ìŠµ í•„ìš” ì‚¬í•­
- HRNet OCR í•™ìŠµì„ ìœ„í•´ì„  imagenet pretrained modelì„ ë‹¤ìš´ë°›ì•„ì•¼í•©ë‹ˆë‹¤.
- ì´ [ë§í¬](https://1drv.ms/u/s!Aus8VCZ_C_33dKvqI6pBZlifgJk)ì—ì„œ hrnetv2_w48_imagenet_pretrained.pth ëª¨ë¸ì„ ë‹¤ìš´ë°›ì•„ `Modules/Hrnet_Sources/` ì•„ë˜ ë‘ì–´ì•¼ í•©ë‹ˆë‹¤. 



----

### ì‹¤í—˜ ê²°ê³¼ ë„ì‹í™”

ë‹¤ìŒ [ë§í¬](https://www.edrawmind.com/online/map.html?sharecode=6184ef514b5544a49698555)ëŠ” ì‹¤í—˜ ëª©ë¡ì„ ë§ˆì¸ë“œë§µ í˜•ì‹ìœ¼ë¡œ ë„ì‹í™”í•œ ê²ƒì´ë‹¤.
![Segmentation31-web-16349014493121112222112](https://user-images.githubusercontent.com/44287798/140483293-89c769c7-37fb-4b21-85b3-d14e3e882c57.png)


